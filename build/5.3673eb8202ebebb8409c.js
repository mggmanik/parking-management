(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{TDBs:function(e,t,n){"use strict";n.r(t),n.d(t,"DashboardModule",(function(){return O}));var i=n("ofXK"),a=n("3Pt+"),r=n("rhD1"),c=n("tyNb"),o=n("0IaG"),s=n("fXoL"),d=n("dNgK"),b=n("kmnG"),h=n("qFsG"),g=n("bTqV");let p=(()=>{class e{constructor(e,t,n){this.matSnackbar=e,this.dialogRef=t,this.data=n,this.registrationNumber=new a.d("",[a.s.required,a.s.pattern(/^[A-Z]{2}[0-9]{1,2}([A-Z])([A-Z]*)[0-9]{4}$/)])}ngOnInit(){this.data&&this.registrationNumber.patchValue(this.data)}saveBooking(){this.registrationNumber.valid?this.dialogRef.close(this.registrationNumber.value):this.matSnackbar.open("Please fill valid registration number!","OK",{duration:3e3})}}return e.\u0275fac=function(t){return new(t||e)(s.Lb(d.a),s.Lb(o.f),s.Lb(o.a))},e.\u0275cmp=s.Fb({type:e,selectors:[["app-booking-modal"]],decls:15,vars:4,consts:[[1,"parent"],["mat-dialog-title","",2,"display","flex","justify-content","space-between"],[2,"font-weight","500","font-size","18pt","font-family","'Rubik', sans-serif"],[1,"material-icons",3,"mat-dialog-close"],["mat-dialog-content",""],[1,"w-100"],["matInput","","placeholder","Registration Number","type","text","required","",2,"text-transform","uppercase",3,"formControl"],["align","center"],["mat-raised-button","","color","primary",3,"click"]],template:function(e,t){1&e&&(s.Qb(0,"div",0),s.Qb(1,"div",1),s.Qb(2,"div",2),s.vc(3),s.Pb(),s.Qb(4,"span",3),s.vc(5," close "),s.Pb(),s.Pb(),s.Mb(6,"hr"),s.Qb(7,"div",4),s.Qb(8,"mat-form-field",5),s.Qb(9,"mat-label"),s.vc(10,"Vehicle Registration Number"),s.Pb(),s.Mb(11,"input",6),s.Pb(),s.Qb(12,"div",7),s.Qb(13,"button",8),s.Xb("click",(function(){return t.saveBooking()})),s.vc(14),s.Pb(),s.Pb(),s.Pb(),s.Pb()),2&e&&(s.Ab(3),s.xc("",t.data?"Release":"Book"," "),s.Ab(1),s.gc("mat-dialog-close",!0),s.Ab(7),s.gc("formControl",t.registrationNumber),s.Ab(3),s.wc(t.data?"Release":"Book"))},directives:[o.g,o.c,o.d,b.b,b.e,h.b,a.c,a.r,a.m,a.e,g.a],styles:[".parent[_ngcontent-%COMP%]{width:30vw}"]}),e})();var l=n("tk/3"),u=n("AytR");let m=(()=>{class e{constructor(e){this.http=e}getToken(){return JSON.parse(localStorage.getItem("pUser")).Authorization}getParkingZones(){let e=this.getToken();return this.http.get(u.a.apiUrl+"/parkingzone/list",{headers:new l.d({Authorization:e})})}getParkingSpacesByZoneID(e){let t=this.getToken();return this.http.post(u.a.apiUrl+"/parkingspace/filter",e,{headers:new l.d({Authorization:t})})}updateParkingSpace(e,t){let n=this.getToken();return this.http.put(`${u.a.apiUrl}/parkingspace/update/${e}`,t,{headers:new l.d({Authorization:n})})}resetParkingSpaces(){let e=this.getToken();return this.http.put(u.a.apiUrl+"/parkingspace/updateAll",{vehicle_reg_num:""},{headers:new l.d({Authorization:e})})}createVehicleParking(e){let t=this.getToken();return this.http.post(u.a.apiUrl+"/vehicleparking/create",e,{headers:new l.d({Authorization:t})})}updateVehicleParking(e,t){let n=this.getToken();return this.http.put(`${u.a.apiUrl}/vehicleparking/update/${e}`,t,{headers:new l.d({Authorization:n})})}deleteAllVehicleParkings(){let e=this.getToken();return this.http.delete(u.a.apiUrl+"/vehicleparking/deleteAll",{headers:new l.d({Authorization:e})})}}return e.\u0275fac=function(t){return new(t||e)(s.Ub(l.b))},e.\u0275prov=s.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var k=n("wZkO");function f(e,t){if(1&e){const e=s.Rb();s.Qb(0,"button",6),s.Xb("click",(function(){return s.mc(e),s.bc().onReset()})),s.vc(1,"Reset"),s.Pb()}}function v(e,t){if(1&e&&(s.Qb(0,"div"),s.Qb(1,"strong"),s.vc(2),s.Pb(),s.Pb()),2&e){const e=s.bc().$implicit;s.Ab(2),s.wc(e.vehicle_reg_num)}}function P(e,t){1&e&&(s.Qb(0,"div"),s.vc(1," NOT BOOKED "),s.Pb())}function S(e,t){if(1&e){const e=s.Rb();s.Qb(0,"div",13),s.Qb(1,"div",14),s.Qb(2,"div",15),s.Qb(3,"p"),s.Qb(4,"strong"),s.vc(5),s.Pb(),s.Pb(),s.Qb(6,"div",16),s.Xb("click",(function(){s.mc(e);const n=t.$implicit,i=s.bc().$implicit;return s.bc().openBookingModal(i._id,n._id,n.vehicle_reg_num,n.vehicle_parking_id)})),s.Pb(),s.Pb(),s.Mb(7,"hr"),s.Qb(8,"div",17),s.uc(9,v,3,1,"div",18),s.uc(10,P,2,0,"div",18),s.Pb(),s.Pb(),s.Pb()}if(2&e){const e=t.$implicit;s.Ab(5),s.wc(e.space_title),s.Ab(1),s.gc("ngClass",e.vehicle_reg_num?"spacestatusoccupied":"spacestatusvacant"),s.Ab(3),s.gc("ngIf",e.vehicle_reg_num),s.Ab(1),s.gc("ngIf",!e.vehicle_reg_num)}}function w(e,t){if(1&e){const e=s.Rb();s.Qb(0,"mat-tab",7),s.Qb(1,"div",8),s.Qb(2,"input",9),s.Xb("change",(function(t){return s.mc(e),s.bc().onFilterVacantSpaces(t)})),s.Pb(),s.Qb(3,"strong",10),s.vc(4,"Show Vacant Spaces"),s.Pb(),s.Pb(),s.Qb(5,"div",11),s.uc(6,S,11,4,"div",12),s.Pb(),s.Pb()}if(2&e){const e=t.$implicit,n=s.bc();s.gc("label",e.zone_title),s.Ab(2),s.gc("checked",n.isChecked),s.Ab(3),s.rc("max-height",n.isAgent?"69vh":"75vh"),s.Ab(1),s.gc("ngForOf",n.filteredSpaces)}}const _=[{path:"",component:(()=>{class e{constructor(e,t,n){this.dashboardService=e,this.matSnackbar=t,this.dialog=n,this.isAgent=!1,this.zones=[],this.filteredSpaces=[]}ngOnInit(){"agent"===JSON.parse(localStorage.getItem("pUser")).role&&(this.isAgent=!0),this.fetchParkingZones()}onReset(){this.dashboardService.resetParkingSpaces().subscribe(e=>{e&&e.data?this.dashboardService.deleteAllVehicleParkings().subscribe(e=>{e&&e.data?this.fetchParkingSpaceByZoneID(this.index):this.matSnackbar.open("Something went wrong !","OK",{duration:3e3})}):this.matSnackbar.open("Something went wrong !","OK",{duration:3e3})})}filterParkingSpace(e){this.isChecked=!1,this.index=e.index,this.fetchParkingSpaceByZoneID(this.index)}onFilterVacantSpaces(e){e&&e.target&&(e.target.checked&&(this.isChecked=!0,this.filteredSpaces=this.filteredSpaces.filter(e=>!e.vehicle_reg_num)),e.target.checked||(this.isChecked=!1,this.fetchParkingSpaceByZoneID(this.index)))}openBookingModal(e,t,n,i){if(!this.isAgent)return;let a,r={},c={};a=n?this.dialog.open(p,{data:n}):this.dialog.open(p),a.afterClosed().subscribe(a=>{a&&"string"==typeof a&&(n?(r={vehicle_reg_num:""},this.dashboardService.updateVehicleParking(i,{release_date_time:new Date}).subscribe(e=>{e&&e.data?this.dashboardService.updateParkingSpace(t,r).subscribe(e=>{e&&e.data?this.fetchParkingSpaceByZoneID(this.index):this.matSnackbar.open("Something went wrong !","OK",{duration:3e3})}):this.matSnackbar.open("Something went wrong !","OK",{duration:3e3})})):(r={vehicle_reg_num:a},c={zone_id:e,space_id:t,vehicle_reg_num:a,booking_date_time:new Date},this.dashboardService.createVehicleParking(c).subscribe(e=>{e&&e.data?(r.vehicle_parking_id=e.data._id,this.dashboardService.updateParkingSpace(t,r).subscribe(e=>{e&&e.data?this.fetchParkingSpaceByZoneID(this.index):this.matSnackbar.open("Something went wrong !","OK",{duration:3e3})})):this.matSnackbar.open("Something went wrong !","OK",{duration:3e3})})))})}fetchParkingZones(){this.dashboardService.getParkingZones().subscribe(e=>{e&&e.data?this.zones=e.data:this.matSnackbar.open("Something went wrong !","OK",{duration:3e3})})}fetchParkingSpaceByZoneID(e){this.dashboardService.getParkingSpacesByZoneID({zoneID:this.zones[e]._id}).subscribe(e=>{e&&e.data?(this.isChecked=!1,this.filteredSpaces=e.data):this.matSnackbar.open("Something went wrong !","OK",{duration:3e3})})}}return e.\u0275fac=function(t){return new(t||e)(s.Lb(m),s.Lb(d.a),s.Lb(o.b))},e.\u0275cmp=s.Fb({type:e,selectors:[["app-home"]],decls:6,vars:2,consts:[[1,"m-3"],["align","right"],["mat-raised-button","","color","primary",3,"click",4,"ngIf"],[1,"mt-2"],["mat-stretch-tabs","",1,"mat-elevation-z4",3,"selectedTabChange"],[3,"label",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary",3,"click"],[3,"label"],["align","center",1,"mt-3"],["type","checkbox",3,"checked","change"],[1,"ml-2"],[1,"row","spaceContent"],["class","col-md-6",4,"ngFor","ngForOf"],[1,"col-md-6"],[1,"spaceContainer"],[1,"spacecard"],[3,"ngClass","click"],["align","center"],[4,"ngIf"]],template:function(e,t){1&e&&(s.Qb(0,"div",0),s.Qb(1,"div",1),s.uc(2,f,2,0,"button",2),s.Pb(),s.Qb(3,"div",3),s.Qb(4,"mat-tab-group",4),s.Xb("selectedTabChange",(function(e){return t.filterParkingSpace(e)})),s.uc(5,w,7,5,"mat-tab",5),s.Pb(),s.Pb(),s.Pb()),2&e&&(s.Ab(2),s.gc("ngIf",t.isAgent),s.Ab(3),s.gc("ngForOf",t.zones))},directives:[i.k,k.b,i.j,g.a,k.a,i.i],styles:[".spaceContent[_ngcontent-%COMP%]{padding:40px 24px;max-height:69vh;overflow-y:auto;width:100%;margin-left:unset}.spaceContent[_ngcontent-%COMP%]   .spaceContainer[_ngcontent-%COMP%]{background:#fff;box-shadow:0 1px 8px rgba(20,46,110,.6);border-radius:8px;padding:1%;margin:1%}.spaceContent[_ngcontent-%COMP%]   .spaceContainer[_ngcontent-%COMP%]   .spacecard[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.spaceContent[_ngcontent-%COMP%]   .spaceContainer[_ngcontent-%COMP%]   .spacecard[_ngcontent-%COMP%]   .spacestatusvacant[_ngcontent-%COMP%]{border-radius:8px;height:30px;width:30px;background-color:green;cursor:pointer}.spaceContent[_ngcontent-%COMP%]   .spaceContainer[_ngcontent-%COMP%]   .spacecard[_ngcontent-%COMP%]   .spacestatusoccupied[_ngcontent-%COMP%]{border-radius:8px;height:30px;width:30px;background-color:#d3d3d3;cursor:pointer}"]}),e})()}];let C=(()=>{class e{}return e.\u0275mod=s.Jb({type:e}),e.\u0275inj=s.Ib({factory:function(t){return new(t||e)},imports:[[c.d.forChild(_)],c.d]}),e})(),O=(()=>{class e{}return e.\u0275mod=s.Jb({type:e}),e.\u0275inj=s.Ib({factory:function(t){return new(t||e)},imports:[[i.b,a.q,C,r.a]]}),e})()}}]);